<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>test_insertion &mdash; pymios 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=359c27e9"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            pymios
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">pymios</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">test_insertion</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for test_insertion</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">task</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">moving</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">connection_test</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>



<span class="n">robot</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
   

<div class="viewcode-block" id="grasp"><a class="viewcode-back" href="../test_insertion.html#test_insertion.grasp">[docs]</a><span class="k">def</span> <span class="nf">grasp</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Control the robot to perform a grasping operation.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - width: The width at which the gripper should open.</span>
<span class="sd">    - force: The force to be applied during the grasping operation.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The result of the grasping operation.</span>

<span class="sd">    libranka description:</span>
<span class="sd">    This function controls the robot to execute a grasping operation by calling the grasp method from libranka.</span>
<span class="sd">    The gripper opens to the specified width and applies the specified force during the grasping process.</span>
<span class="sd">    The parameters epsilon_inner and epsilon_outer define the precision of the grasping operation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
        <span class="s2">&quot;speed&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
        <span class="s2">&quot;force&quot;</span><span class="p">:</span> <span class="n">force</span><span class="p">,</span>
        <span class="s2">&quot;epsilon_inner&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s2">&quot;epsilon_outer&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> 

    <span class="p">}</span>
    <span class="k">return</span> <span class="n">call_method</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s2">&quot;grasp&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span></div>

<div class="viewcode-block" id="move_gripper"><a class="viewcode-back" href="../test_insertion.html#test_insertion.move_gripper">[docs]</a><span class="k">def</span> <span class="nf">move_gripper</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Control the robot to move the gripper to a specified width.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - width: The target width for the gripper.</span>

<span class="sd">    Returns:</span>
<span class="sd">    The result of the gripper movement.</span>

<span class="sd">    libranka description:</span>
<span class="sd">    This function utilizes libranka to control the robot&#39;s gripper, moving it to the specified width.</span>
<span class="sd">    The movement speed is set to 0.05 to ensure a controlled and gradual gripper motion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">width</span><span class="p">,</span>
        <span class="s2">&quot;speed&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">call_method</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s2">&quot;move_gripper&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span></div>


<div class="viewcode-block" id="modify_taught_pose"><a class="viewcode-back" href="../test_insertion.html#test_insertion.modify_taught_pose">[docs]</a><span class="k">def</span> <span class="nf">modify_taught_pose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param x: X-coordinate for the object&#39;s position.</span>
<span class="sd">    :param y: Y-coordinate for the object&#39;s position.</span>
<span class="sd">    :param z: Z-coordinate for the object&#39;s position.</span>
<span class="sd">    :param name: A string representing the object&#39;s name.</span>
<span class="sd">    </span>
<span class="sd">    :return: The result of the modify_taught_pose operation.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span>
            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z</span><span class="p">,</span>
            <span class="c1">#&quot;R&quot;: [0, 1, 0, 1, 0, 0, 0, 0, -1],</span>
            <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="c1">#[1, 0, 0, 0, 1, 0, 0, 0, 1]</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">call_method</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s2">&quot;set_partial_object_data&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="moveJ"><a class="viewcode-back" href="../test_insertion.html#test_insertion.moveJ">[docs]</a><span class="k">def</span> <span class="nf">moveJ</span><span class="p">(</span><span class="n">q_g</span><span class="p">):</span>     
<span class="w">         </span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move the robot to a specified joint pose.</span>

<span class="sd">        Args:</span>
<span class="sd">        q_g (list): Joint pose.</span>
<span class="sd">        robot: The robot object.</span>

<span class="sd">        Returns:</span>
<span class="sd">        The result of the movement task.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;pose&quot;</span><span class="p">:</span> <span class="s2">&quot;NoneObject&quot;</span><span class="p">,</span>
            <span class="s2">&quot;q_g&quot;</span><span class="p">:</span> <span class="n">q_g</span><span class="p">,</span>
            <span class="s2">&quot;speed&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="s2">&quot;acc&quot;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>        
            <span class="p">}</span>       
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">start_task_and_wait</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="s2">&quot;MoveToJointPose&quot;</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>

<span class="n">container</span> <span class="o">=</span> <span class="n">teach_location</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;container&quot;</span><span class="p">)</span>
<span class="n">approach</span> <span class="o">=</span> <span class="n">teach_location</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;approach&quot;</span><span class="p">)</span>
<span class="n">obj1</span> <span class="o">=</span> <span class="n">teach_location</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="s2">&quot;obj1&quot;</span><span class="p">)</span>
<span class="n">time_max</span> <span class="o">=</span> <span class="mi">10</span>  

<div class="viewcode-block" id="insertion"><a class="viewcode-back" href="../test_insertion.html#test_insertion.insertion">[docs]</a><span class="k">def</span> <span class="nf">insertion</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">approach</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">time_max</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Executes an insertion task with the robot.</span>

<span class="sd">    This function performs an insertion task with the robot. It sets the grasped object of the robot to &quot;obj1&quot;,</span>
<span class="sd">    defines parameters for the insertion task, creates a Task object, adds the insertion skill to it, starts the task,</span>
<span class="sd">    waits for its completion, and returns the result.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The result of the insertion task execution.</span>

<span class="sd">        1.First Output (printed inside the function):</span>
<span class="sd">        It displays the current state of the robot, including the end-effector&#39;s pose, the current task status, etc.</span>

<span class="sd">        2.Second Output (printed inside the function):</span>
<span class="sd">        It shows the parameter configuration for the insertion task, including skill parameters, control parameters, and user-defined environmental parameters.</span>

<span class="sd">        3.Third Output (printed outside the function):</span>
<span class="sd">        It indicates the time taken for task execution, where 7.084 seconds were spent on executing the insertion task.</span>

<span class="sd">        4.Final Output (the return result of the function):</span>
<span class="sd">        -It is a dictionary containing the results of task execution.</span>
<span class="sd">        -Under the &#39;result&#39; key is a sub-dictionary containing detailed task execution results.</span>
<span class="sd">        -The &#39;error&#39; key indicates whether there were any errors during execution, which is empty here, indicating no errors.</span>
<span class="sd">        -Under the &#39;task_result&#39; key are detailed results of the task.</span>
<span class="sd">        -The &#39;success&#39; key indicates whether the task was successfully completed, which is True here, indicating successful completion.</span>
<span class="sd">        -Under the &#39;skill_results&#39; key is a sub-dictionary containing the execution results of each skill.</span>
<span class="sd">        -Under &#39;insertion&#39; key is the execution result of the insertion skill.</span>
<span class="sd">        -The &#39;cost&#39; key holds a sub-dictionary with the cost assessment results of the insertion task, such as contact forces, desired force, and pose deviation.</span>
<span class="sd">        -The &#39;heuristic&#39; key indicates the heuristic evaluation result of the insertion task.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Any: Any exceptions raised during task execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;container&quot;</span>
    <span class="n">approach</span> <span class="o">=</span> <span class="s2">&quot;approach&quot;</span>
    <span class="n">obj1</span> <span class="o">=</span> <span class="s2">&quot;obj1&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">call_method</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s2">&quot;get_state&quot;</span><span class="p">))</span>
    <span class="n">call_method</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s2">&quot;set_grasped_object&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="n">obj1</span><span class="p">})</span>
    <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;skill&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{</span>
          
                <span class="s2">&quot;Container&quot;</span><span class="p">:</span> <span class="n">container</span><span class="p">,</span>
                <span class="s2">&quot;Approach&quot;</span><span class="p">:</span> <span class="n">approach</span><span class="p">,</span>
                <span class="s2">&quot;Insertable&quot;</span><span class="p">:</span> <span class="n">obj1</span>                
            <span class="p">},</span>
            
            <span class="s2">&quot;time_max&quot;</span><span class="p">:</span> <span class="n">time_max</span><span class="p">,</span>
            

            <span class="c1"># p0: the first mp, indicating the move_to_pose &quot;Approach&quot;</span>
            <span class="s2">&quot;p0&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="c1"># This is a list of length 2, indicating the target translation velocities of the robot end-effector in the X and Y directions during the insertion action. In this example, dX_d is [0.1, 0.5], indicating a target velocity of 0.1 meters per second in the X direction and 0.5 meters per second in the Y direction.</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="c1"># This is a list of length 2, indicating the target accelerations of the robot end-effector in the X and Y directions during the insertion action. In this example, ddX_d is [0.5, 1], indicating a target acceleration of 0.5 meters per second squared in the X direction and 1 meter per second squared in the Y direction.</span>
                <span class="s2">&quot;DeltaX&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1"># This is a list of length 6, representing the corresponding displacement increments during the insertion action. In this example, DeltaX is [0, 0, 0, 0, 0, 0], indicating no displacement in the X, Y, and Z directions.</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span> <span class="c1"># This is a list of length 6, representing the control gains during the insertion action. In this example, K_x is [1500, 1500, 1500, 100, 100, 100], indicating control gains of 1500 in the X, Y, and Z directions and 100 in rotation directions. These gains are used to adjust the stability and accuracy of the robot during the insertion action.</span>
            <span class="p">},</span>
            <span class="c1"># p1: the second mp, indicating the move_to_contact, along the direction &quot;Approach&quot; -&gt; &quot;Container&quot;</span>
            <span class="s2">&quot;p1&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> <span class="c1"># This is a list of length 2, indicating the target translation velocities of the robot end-effector in the X and Y directions during the insertion action. Here, dX_d is [0.02, 0.05], meaning a target velocity of 0.02 meters per second in the X direction and 0.05 meters per second in the Y direction.</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="c1"># This is a list of length 2, indicating the target accelerations of the robot end-effector in the X and Y directions during the insertion action. In this example, ddX_d is [0.5, 0.1], indicating a target acceleration of 0.5 meters per second squared in the X direction and 0.1 meters per second squared in the Y direction.</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span> <span class="c1"># This is a list of length 6, representing the control gains during the insertion action. Here, K_x is [500, 500, 500, 100, 100, 100], indicating control gains of 500 in the X, Y, and Z directions and 100 in rotation directions. These gains are used to adjust the stability and accuracy of the robot during the insertion action.</span>
            <span class="p">},</span>
            <span class="c1"># p2: the third mp, indicating the insertion</span>
            <span class="s2">&quot;p2&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;search_a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1"># This is a list of length 6, representing the search amplitudes during the insertion action. It determines the range of motion or deviation allowed during the insertion process. For example, [4, 6, 15, 0, 0, 0] implies that there&#39;s a search amplitude of 4 in the X direction, 6 in the Y direction, and 15 in the Z direction, while no search amplitude is specified for rotation.</span>
                <span class="c1"># &quot;search_a&quot;: [5, 5, 0, 2, 2, 0],</span>
                <span class="s2">&quot;search_f&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1"># This is a list of length 6, indicating the search frequencies during the insertion action. It determines how rapidly the system explores the search space. For instance, [1.2, 1.2, 0, 1.2, 1, 0] suggests a search frequency of 1.2 Hz in the X, Y, and Z directions, and 1 Hz for rotation, except for no search frequency specified in the Z rotation.</span>
                <span class="c1"># &quot;search_a&quot;: [0, 0, 0, 0, 0, 0],</span>
                <span class="c1"># &quot;search_f&quot;: [0, 0, 0, 0, 0, 0],</span>
                <span class="s2">&quot;search_phi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1"># This is a list of length 6, representing the search phases during the insertion action. It determines the starting phase of the search motion. Here, [0, math.pi/2, 0, 0, 0, 0] indicates that the search starts from 0 radians in the X direction and Ï€/2 radians (90 degrees) in the Y direction, while no phase shift is applied to other directions.</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="c1"># This is a list of length 6, representing the control gains during the insertion action, similar to previous instances. It adjusts the stability and accuracy of the robot during insertion.</span>
                <span class="s2">&quot;f_push&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="c1"># This is a list of length 6, specifying the pushing forces during the insertion action. It defines the magnitude of the force applied to the object being inserted. For example, [0, 0, 15, 0, 0, 0] indicates a force of 15 Newtons along the Z direction.</span>
                <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="c1"># This is a list of length 2, similar to previous instances, indicating the target translation velocities of the robot end-effector in the X and Y directions during the insertion action.</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># This is a list of length 2, similar to previous instances, indicating the target accelerations of the robot end-effector in the X and Y directions during the insertion action.</span>
            <span class="p">},</span>
            <span class="c1"># p3: not used</span>
            <span class="s2">&quot;p3&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span> <span class="c1"># This is a list of length 2, indicating the target translation velocities of the robot end-effector in the X and Y directions during the insertion action. It specifies the desired linear velocity for the insertion task. Here, [0.1, 0.5] suggests a target velocity of 0.1 meters per second in the X direction and 0.5 meters per second in the Y direction.</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="c1"># This is a list of length 2, indicating the target accelerations of the robot end-effector in the X and Y directions during the insertion action. It specifies the desired linear acceleration for the insertion task. For instance, [0.5, 1] implies a target acceleration of 0.5 meters per second squared in the X direction and 1 meter per second squared in the Y direction.</span>
                <span class="s2">&quot;f_push&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="c1"># This parameter indicates the pushing force during the insertion action. It defines the magnitude of the force applied by the robot end-effector while inserting the object. Here, f_push is set to 10, indicating a pushing force of 10 Newtons.</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">]</span> <span class="c1"># This is a list of length 6, representing the control gains during the insertion action. It adjusts the stability and accuracy of the robot during the insertion process. The values specified here affect the control behavior of the robot&#39;s end-effector. For example, [500, 500, 0, 800, 800, 800] suggests control gains of 500 in the X and Y directions, no gain in the Z direction, and 800 in rotation.</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;control&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;control_mode&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="c1"># user: Limited conditions to determine whether the Insertion execution is successful, such as position and velocity tolerances, and maximum contact forces</span>
        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;env_X&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span> <span class="c1"># This parameter is a list of length 6, representing the environmental conditions related to position in the X, Y, and Z directions. It specifies the position tolerances or variations allowed in the environment. For example, [0.01, 0.01, 0.002, 0.05, 0.05, 0.05] indicates tolerance values of 0.01 meters in the X and Y directions, 0.002 meters in the Z direction, and 0.05 meters for rotation.</span>
            <span class="s2">&quot;env_dX&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">],</span> <span class="c1"># This parameter is a list of length 6, similar to env_X, but it represents the environmental conditions related to velocity. It specifies the allowed velocity variations or tolerances in the environment. For instance, [0.001, 0.001, 0.001, 0.005, 0.005, 0.005] suggests velocity tolerance values of 0.001 meters per second in the X, Y, and Z directions, and 0.005 meters per second for rotation.</span>
            <span class="s2">&quot;F_ext_contact&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span> <span class="c1"># This parameter is a list of length 2, representing the external contact forces. It specifies the maximum forces allowed to be exerted on the objects or surfaces in contact with the robot during the insertion task. Here, [2.0, 1.0] indicates maximum contact forces of 2.0 Newtons in the X, Y, and Z directions and 1.0 Newtons for rotation.</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">add_skill</span><span class="p">(</span><span class="s2">&quot;insertion&quot;</span><span class="p">,</span> <span class="s2">&quot;TaxInsertion&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">result</span></div>






<div class="viewcode-block" id="extract"><a class="viewcode-back" href="../test_insertion.html#test_insertion.extract">[docs]</a><span class="k">def</span> <span class="nf">extract</span><span class="p">():</span>
    <span class="n">move_gripper</span><span class="p">(</span><span class="mf">0.002</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">move_gripper</span><span class="p">(</span><span class="mf">0.0005</span><span class="p">)</span>
    <span class="n">teach_location</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="s2">&quot;above&quot;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">call_method</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s2">&quot;get_state&quot;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s1">&#39;O_T_EE&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s1">&#39;O_T_EE&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;result&quot;</span><span class="p">][</span><span class="s1">&#39;O_T_EE&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.05</span>
    <span class="n">modify_taught_pose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="s2">&quot;above&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Housing pose:&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>
    <span class="n">move_to_location</span><span class="p">(</span><span class="n">robot</span><span class="p">,</span> <span class="s2">&quot;above&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="extract_skill"><a class="viewcode-back" href="../test_insertion.html#test_insertion.extract_skill">[docs]</a><span class="k">def</span> <span class="nf">extract_skill</span><span class="p">(</span><span class="n">container</span><span class="p">,</span> <span class="n">approach</span><span class="p">,</span> <span class="n">obj1</span><span class="p">,</span> <span class="n">time_max</span><span class="p">):</span>
    <span class="n">container</span> <span class="o">=</span> <span class="s2">&quot;container&quot;</span>
    <span class="n">approach</span> <span class="o">=</span> <span class="s2">&quot;approach&quot;</span>
    <span class="n">obj1</span> <span class="o">=</span> <span class="s2">&quot;obj1&quot;</span>
   
    <span class="n">extraction_context</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;skill&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;Container&quot;</span><span class="p">:</span> <span class="n">container</span><span class="p">,</span>
                <span class="s2">&quot;ExtractTo&quot;</span><span class="p">:</span> <span class="n">approach</span><span class="p">,</span>
                <span class="s2">&quot;Extractable&quot;</span><span class="p">:</span> <span class="n">obj1</span>
            <span class="p">},</span>
            <span class="s2">&quot;time_max&quot;</span><span class="p">:</span> <span class="n">time_max</span><span class="p">,</span>
            <span class="s2">&quot;p0&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;search_a&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;search_f&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span><span class="p">],</span>
                <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="s2">&quot;p1&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">},</span>
        <span class="s2">&quot;control&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;control_mode&quot;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">},</span>
        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;env_X&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
            <span class="s2">&quot;env_dX&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="n">t</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="n">robot</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">add_skill</span><span class="p">(</span><span class="s2">&quot;extraction&quot;</span><span class="p">,</span> <span class="s2">&quot;TaxExtraction&quot;</span><span class="p">,</span> <span class="n">extraction_context</span><span class="p">)</span>
    <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span></div>



<div class="viewcode-block" id="Insertion"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion">[docs]</a><span class="k">class</span> <span class="nc">Insertion</span><span class="p">:</span>
    <span class="c1">#a = None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">object_id</span><span class="o">=</span><span class="s2">&quot;obj1&quot;</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">object_id</span> <span class="o">=</span> <span class="n">object_id</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">time_max</span> <span class="o">=</span> <span class="mi">10</span>  
        
      <span class="bp">self</span><span class="o">.</span><span class="n">search_a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">search_f</span> <span class="o">=</span>  <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">search_phi</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">K_x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">f_push</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">env_X</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">F_ext_contact</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">prepared</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># New attribute to track whether prepare has been executed</span>
    <span class="c1">#   self.content = s</span>

  
    <span class="c1">#First run the prepare function to set the initial state of the robot</span>
<div class="viewcode-block" id="Insertion.prepare"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.prepare">[docs]</a>    <span class="k">def</span> <span class="nf">prepare</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">robot</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">approach</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span><span class="n">container</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="n">obj1</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter your taught pose name for obj1: &quot;</span><span class="p">)</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Please move the robot to the object position and press Enter to continue...&quot;</span><span class="p">)</span>
        <span class="n">teach_location</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">obj1</span><span class="p">)</span>

        <span class="n">approach</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter your taught pose name for approach: &quot;</span><span class="p">)</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Please move the robot to the approach position and press Enter to continue...&quot;</span><span class="p">)</span>
        <span class="n">teach_location</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">approach</span><span class="p">)</span>
        
        
        <span class="n">container</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Enter your taught pose name for container: &quot;</span><span class="p">)</span>
        <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Please move the robot to the container position and press Enter to continue...&quot;</span><span class="p">)</span>
        <span class="n">teach_location</span><span class="p">(</span><span class="s2">&quot;localhost&quot;</span><span class="p">,</span> <span class="n">container</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prepared</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prepare method has been executed.&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Insertion.modify_time"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.modify_time">[docs]</a>    <span class="k">def</span> <span class="nf">modify_time</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_max</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_max</span> <span class="o">=</span> <span class="n">time_max</span></div>
    
    
<div class="viewcode-block" id="Insertion.modify_search_amplitudes"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.modify_search_amplitudes">[docs]</a>    <span class="k">def</span> <span class="nf">modify_search_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">search_a</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_a</span> <span class="o">=</span> <span class="n">search_a</span></div>
    
<div class="viewcode-block" id="Insertion.modify_F_ext_contact"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.modify_F_ext_contact">[docs]</a>    <span class="k">def</span> <span class="nf">modify_F_ext_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">F_ext_contact</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F_ext_contact</span> <span class="o">=</span> <span class="n">F_ext_contact</span></div>
    
    <span class="c1">#def modify_search_phi(self,search_phi):</span>
     <span class="c1">#   self.search_phi= search_phi</span>
    
    <span class="c1">#def modify_K_x(self,K_x):</span>
     <span class="c1">#   self.K_x= K_x</span>

<div class="viewcode-block" id="Insertion.modify_f_push"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.modify_f_push">[docs]</a>    <span class="k">def</span> <span class="nf">modify_f_push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f_push</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_pushx</span> <span class="o">=</span> <span class="n">f_push</span>    </div>

<div class="viewcode-block" id="Insertion.modify_lissajous"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.modify_lissajous">[docs]</a>    <span class="k">def</span> <span class="nf">modify_lissajous</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">search_phi</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_phi</span> <span class="o">=</span> <span class="n">search_phi</span></div>

<div class="viewcode-block" id="Insertion.modify_succ_condition"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.modify_succ_condition">[docs]</a>    <span class="k">def</span> <span class="nf">modify_succ_condition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">env_X</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_X</span> <span class="o">=</span> <span class="n">env_X</span></div>

    <span class="k">def</span> <span class="nf">modify_stiffness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">K_x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K_x</span> <span class="o">=</span> <span class="n">K_x</span>
    
<div class="viewcode-block" id="Insertion.modify_stiffness"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.modify_stiffness">[docs]</a>    <span class="k">def</span> <span class="nf">modify_stiffness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">K_x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K_x</span> <span class="o">=</span> <span class="n">K_x</span></div>

<div class="viewcode-block" id="Insertion.save_to_json"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.save_to_json">[docs]</a>    <span class="k">def</span> <span class="nf">save_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;robot&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span>
            <span class="s2">&quot;object_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_id</span><span class="p">,</span>
            <span class="s2">&quot;time_max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_max</span><span class="p">,</span>
            <span class="s2">&quot;search_a&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_a</span><span class="p">,</span>
            <span class="s2">&quot;search_f&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_f</span><span class="p">,</span>
            <span class="s2">&quot;search_phi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_phi</span><span class="p">,</span>
            <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">K_x</span><span class="p">,</span>
            <span class="s2">&quot;f_push&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_push</span><span class="p">,</span>
            <span class="s2">&quot;env_X&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_X</span><span class="p">,</span>
            <span class="s2">&quot;F_ext_contact&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">F_ext_contact</span><span class="p">,</span>
            <span class="c1">#&quot;prepared&quot;: self.prepared</span>
        <span class="p">}</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data saved to </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Insertion.load_from_json"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.load_from_json">[docs]</a>    <span class="k">def</span> <span class="nf">load_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;robot&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object_id</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;object_id&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_max</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;time_max&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_a</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;search_a&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_f</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;search_f&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">search_phi</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;search_phi&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">K_x</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;K_x&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_push</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;f_push&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env_X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;env_X&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">F_ext_contact</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;F_ext_contact&quot;</span><span class="p">]</span>
            <span class="c1">#self.prepared = data[&quot;prepared&quot;]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data loaded from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Insertion.execute"><a class="viewcode-back" href="../test_insertion.html#test_insertion.Insertion.execute">[docs]</a>    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Check if prepare has been executed before proceeding with any other logic</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Please execute the prepare method before executing.&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># Content of the original execute method</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Executing the task...&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">call_method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s2">&quot;get_state&quot;</span><span class="p">))</span>
        <span class="n">call_method</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s2">&quot;set_grasped_object&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;object&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_id</span><span class="p">})</span>
        <span class="n">content</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;skill&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;objects&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;Container&quot;</span><span class="p">:</span> <span class="s2">&quot;container&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Approach&quot;</span><span class="p">:</span> <span class="s2">&quot;approach&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Insertable&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">object_id</span>                
                <span class="p">},</span>
                <span class="s2">&quot;time_max&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_max</span><span class="p">,</span> 
                <span class="s2">&quot;p0&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;DeltaX&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;p1&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;p2&quot;</span><span class="p">:</span> <span class="p">{</span>
                     <span class="s2">&quot;search_a&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_a</span><span class="p">,</span>
                <span class="c1"># &quot;search_a&quot;: [5, 5, 0, 2, 2, 0],</span>
                <span class="s2">&quot;search_f&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_f</span><span class="p">,</span>
                <span class="c1"># &quot;search_a&quot;: [0, 0, 0, 0, 0, 0],</span>
                <span class="c1"># &quot;search_f&quot;: [0, 0, 0, 0, 0, 0],</span>
                <span class="s2">&quot;search_phi&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_phi</span><span class="p">,</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">K_x</span><span class="p">,</span>
                <span class="s2">&quot;f_push&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f_push</span><span class="p">,</span>
                <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="s2">&quot;p3&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;dX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
                <span class="s2">&quot;ddX_d&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;f_push&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                <span class="s2">&quot;K_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="mi">800</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s2">&quot;control&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;control_mode&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">},</span>
            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;env_X&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_X</span><span class="p">,</span>
            <span class="s2">&quot;env_dX&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">],</span>
            <span class="s2">&quot;F_ext_contact&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">F_ext_contact</span>
                
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">Task</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">add_skill</span><span class="p">(</span><span class="s2">&quot;insertion&quot;</span><span class="p">,</span> <span class="s2">&quot;TaxInsertion&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resultï¼š&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span></div></div>
    


</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, yansong.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>